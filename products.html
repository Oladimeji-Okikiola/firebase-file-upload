<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="newprofile.css">
    <link rel="stylesheet" href="products.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <title>products</title>
</head>
<body>
    <!-- THE NAVIGATION BAR -->
   <div class="header">
    <div class="logo">
        <h3>KAMPUS KONNECT</h3>
    </div>
    <div class="navigation">
        <div class="navAndPic">
            <div class="navBar">
                <ul>
                    <li><a href="newprofile.html">Home</a></li>
                    <li><a href="chat.html">Chat</a></li>
                    <li><a href="catalogue.html">Catalogue</a></li>
                    <li><a href="notes.html">Note</a></li>
                    <li><a href="./departments/marketPlace.html">Market Place</a></li>
                    <li><a href="aboutTwo.html">About us</a></li>
                    <li id="signOut">Sign Out</li>
                </ul>
            </div>
            <div class="nameBar">
                <h3  id="usernamed"></h3>
            </div>
        </div>
        <div class="userImageAndName">
            <img src="images/profile image.png" alt="profile picture" id="userImage" style="height: 60px; width: 60px; border-radius: 50%;">
            <!-- <h3  id="usernamed"></h3> -->
        </div>
    </div>
</div>
<!-- SEARCH BAR -->
<div class="searchBox">
    <input type="text" id="searchInput" placeholder="search product...">
    <i class="fa fa-search" id="searchThrough" style="font-size: 20px;"></i>
</div>

<div class="productCard" id="productCard">
    <!-- <div class="innerCard">
        <img src="images/30000mAh power bank.jpg" class="productImages" alt="vegetable spicy" width="40%">
        <div class="otherDetails"></div>
        <h3>30000mAh Powerbank</h3>
        <p>
            A power bank for everyday use.
        </p>
        <h3>&#x20A6;34,000</h3>
        <a href="#"><button id="buyBtn">Buy now</button></a>
    </div>
    <div class="innerCard">
        <img src="images/50000mAh power bank.jpg" class="productImages" alt="vegetable spicy" width="40%">
        <h3>50000mAh Powerbank</h3>
        <p>
            A power bank for everyday use.
        </p>
        <h3>&#x20A6;52000</h3>
        <a href="#"><button id="buyBtn">Buy now</button></a>
    </div>
    <div class="innerCard">
        <img src="images/anker powerport.jpg" class="productImages" alt="vegetable spicy" width="40%">
        <h3>Anker Powerport</h3>
        <p>
            A very powerful charger for indoor and outdoor use
        </p>
        <h3>&#x20A6;19,350</h3>
        <a href="#"><button id="buyBtn">Buy now</button></a>
    </div>
    <div class="innerCard">
        <img src="images/vegetable spicy.jpeg" class="productImages" alt="vegetable spicy" width="40%">
        <h3>Vegetable spicy</h3>
        <p>
            This is a vegetable spicy soup good for the body and the food we consume daily
        </p>
        <h3>&#x20A6;500</h3>
        <a href="#"><button id="buyBtn">Buy now</button></a>
    </div>
    <div class="innerCard">
        <img src="images/anker prime 75W.jpg" class="productImages" alt="vegetable spicy" width="40%">
        <h3>Anker Prime</h3>
        <p>
            Anker Prime is a newly released 75W charger for power and heavy duties
        </p>
        <h3>&#x20A6;24950</h3>
        <a href="#"><button id="buyBtn">Buy now</button></a>
    </div>
    <div class="innerCard">
        <img src="images/iphone12 pro.jpg" class="productImages" alt="vegetable spicy" width="40%">
        <h3>iphone12 Pro</h3>
        <p>
            iphone12 pro in a limited color
        </p>
        <h3>&#x20A6;470,000</h3>
        <a href="#"><button id="buyBtn">Buy now</button></a>
    </div>
    <div class="innerCard">
        <img src="images/vegetable spicy.jpeg" class="productImages" alt="vegetable spicy" width="40%">
        <h3>Vegetable spicy</h3>
        <p>
            This is a vegetable spicy soup good for the body and the food we consume daily
        </p>
        <h3>&#x20A6;500</h3>
        <a href="#"><button id="buyBtn">Buy now</button></a>
    </div>
    <div class="innerCard">
        <img src="images/men black shoe.jpg" class="productImages" alt="vegetable spicy" width="40%">
        <h3>Men Black Shoe</h3>
        <p>
            Men's Black Shoe for occasion
            
        </p>
        <h3>&#x20A6;12,350</h3>
        <a href="#"><button id="buyBtn">Buy now</button></a>
    </div>
    <div class="innerCard">
        <img src="images/men's sneaker.jpg" class="productImages" alt="vegetable spicy" width="40%">
        <h3>Men's Sneaker</h3>
        <p>
            Men's Sneaker for occasional
            
        </p>
        <h3>&#x20A6;10,350</h3>
        <a href="#"><button id="buyBtn">Buy now</button></a>
    </div> -->
</div>

<script type="module" src="newprofile.js"></script>

<script type="module">
    let searchThrough = document.getElementById('searchThrough')
    let productCard = document.getElementById('productCard')

        let searchBtn = document.getElementById('searchInput');
        let querySnapshot = [];
        
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
        import { getFirestore, doc, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";
        
        const firebaseConfig = {
          apiKey: "AIzaSyBmY2XtNwXZrHeE5za2cp7sOFYOKjSvdCQ",
          authDomain: "school-newusersign.firebaseapp.com",
          projectId: "school-newusersign",
          storageBucket: "school-newusersign.appspot.com",
          messagingSenderId: "382800829354",
          appId: "1:382800829354:web:145aeb3f8e346c016129d3"
        };
        
        const app = initializeApp(firebaseConfig);
        let db = getFirestore();
        let displayTutorial = document.getElementById('mainDisplay');
        const myCollection = collection(db, 'PRODUCTS');
        
        // // THE SEARCH WITH CLICKING
        // searchThrough.addEventListener('click', e => {
        //     let searchedString = e.target.value.toLowerCase();
        //     let returnValue = querySnapshot.docs.filter(newEntry => {
        //         return newEntry.data().productName.toLowerCase().includes(searchedString);
        //     });
        //     displayDataIn(returnValue);
        // });



        // THE SEARCH WITH KEYUP

        searchBtn.addEventListener('keyup', e => {
            let searchedString = e.target.value.toLowerCase();
            console.log(searchedString);
            let returnValue = querySnapshot.docs.filter(newEntry => {
                return newEntry.data().productName.toLowerCase().includes(searchedString);
            });
            displayDataIn(returnValue);
        });
        
        async function readAllDocuments() {
          try {
            querySnapshot = await getDocs(myCollection);
            displayDataIn(querySnapshot);
          } catch (error) {
            console.error('Error reading documents: ', error);
          }
        }
        
        readAllDocuments();


    function displayDataIn(querySnapshot) {
        productCard.innerHTML = ''; // Clear previous content
        querySnapshot.forEach((element) => {
        let newDiv = document.createElement('div');
        newDiv.setAttribute('class', 'innerCard');
        newDiv.innerHTML = `
        <img src="${element.data().productImage}" class="productImages" alt="vegetable spicy" width="40%">
        <p class="productName">${element.data().productName}</p>
        <p>
            ${element.data().productDescription}
        </p>
        <h3>&#x20A6;${element.data().productPrice}</h3>
        <button class="buyBtn">Buy now</button>
        `;

        // Add event listener to the button to redirect to WhatsApp with product details
        newDiv.querySelector('.buyBtn').addEventListener('click', () => {
            const productName = element.data().productName;
            const productDescription = element.data().productDescription;
            const productImage = element.data().productImage;
            const whatsappLink = element.data().productContact;
            
            // Construct the WhatsApp message
            const message = `Product Name: ${productName}\nDescription: ${productDescription}\nImage: ${productImage}`;
            const encodedMessage = encodeURIComponent(message);
            const fullWhatsappLink = `${whatsappLink}?text=${encodedMessage}`;

            // Redirect to the constructed WhatsApp link
            window.location.href = fullWhatsappLink;
        });

        productCard.appendChild(newDiv);
    });
}
        
        // function displayDataIn(querySnapshot) {
        //     productCard.innerHTML = ''; 
        //     querySnapshot.forEach((element) => {
        //         let newDiv = document.createElement('div')
        //         newDiv.setAttribute('class', 'innerCard')
        //         newDiv.innerHTML = `
                
        //         <img src="${element.data().productImage}" class="productImages" alt="vegetable spicy" width="40%">
        //         <p class="productName">${element.data().productName}</p>
        //         <p>
        //             ${element.data().productDescription}
                    
        //         </p>
        //         <h3>&#x20A6;${element.data().productPrice}</h3>
        //         <a href="${element.data().productContact}"><button id="buyBtn">Buy now</button></a>
                
        //     `
        //     productCard.appendChild(newDiv)
        //     });
        // }

</script>
</body>
</html>